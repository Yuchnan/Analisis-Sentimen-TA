"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.6.1"
__checksum__ = "caf5a53f23726cf8bfa6725a6789bacf4710c6bcb0d5367dd704460a8db03717"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), None, (128, 19), (147, 22), (169, 7), (176, 13), (189, 18), None, (207, 29), (236, 37), (273, 19), (292, 9), (301, 36), (337, 24), (361, 10), (371, 18), None, (389, 62), (451, 8), (459, 22), (481, 19), (500, 13), (513, 14), (527, 14), None, None, (541, 40), (581, 20), (601, 25), (626, 22), (648, 22), (670, 28), None, (698, 15), (713, 25), (738, 8), (746, 13), (759, 10), None, (769, 17), (786, 6), (792, 19), (811, 16), (827, 5), (832, 19), (851, 14), (865, 11), (876, 18), (894, 27), (921, 7), (928, 11), (939, 15), (954, 12), (966, 20), (986, 8), (994, 27), (1021, 46), (1067, 25), (1092, 16), (1108, 8), (1116, 5), (1121, 22), (1143, 18), None, (1161, 36), (1197, 15), (1212, 24), (1236, 11), None, (1247, 10), (1257, 23), (1280, 18), (1298, 18), None, (1316, 20), (1336, 26), (1362, 27), (1389, 28), (1417, 20), (1437, 59), (1496, 14), (1510, 14), (1524, 8), (1532, 8), (1540, 10), (1550, 13), (1563, 20), (1583, 19), None, (1602, 13), (1615, 26), (1641, 11), (1652, 4), (1656, 22), (1678, 19), (1697, 15), (1712, 14), (1726, 28), (1754, 11), (1765, 10), (1775, 12), (1787, 25), None, (1812, 19), (1831, 14), (1845, 26), (1871, 45), (1916, 15), None, (1931, 11), (1942, 30), (1972, 21), (1993, 26), (2019, 6), (2025, 6), (2031, 14), (2045, 5), (2050, 30), (2080, 23), (2103, 6), (2109, 17), (2126, 8), (2134, 12), (2146, 12), (2158, 70), (2228, 55), (2283, 12), (2295, 23), (2318, 16), (2334, 29), (2363, 9), (2372, 24), (2396, 44), (2440, 6), (2446, 41), (2487, 22), (2509, 23), (2532, 31), (2563, 20), (2583, 8), (2591, 15), (2606, 12), (2618, 32), (2650, 25), (2675, 15), None, (2690, 46), (2736, 21), (2757, 17), (2774, 18), (2792, 26), (2818, 5), (2823, 37), (2860, 39), (2899, 16), (2915, 33), (2948, 17), (2965, 23), (2988, 21), (3009, 25), (3034, 8), (3042, 14), (3056, 7), (3063, 37), None, (3100, 18), (3118, 21), (3139, 20), (3159, 17), (3176, 24), (3200, 12), (3212, 36), (3248, 35), (3283, 12), (3295, 57), (3352, 25), (3377, 32), None, (3409, 8), (3417, 25), (3442, 18), (3460, 6), (3466, 23), None, (3489, 36), (3525, 33), (3558, 14), (3572, 16), (3588, 22), None, (3610, 30), (3640, 41), (3681, 50), (3731, 15), (3746, 20), (3766, 31), (3797, 21), (3818, 32), (3850, 24), (3874, 20), (3894, 17), (3911, 52), (3963, 6), (3969, 9), (3978, 12), (3990, 18), (4008, 11), (4019, 10), (4029, 39), (4068, 42), None, (4110, 36), (4146, 17), None, (4163, 8), (4171, 8), (4179, 7), None, (4186, 25), (4211, 17), None, (4228, 21), (4249, 35), (4284, 21), (4305, 10), (4315, 48), (4363, 11), (4374, 37), (4411, 25), (4436, 19), (4455, 12), (4467, 14), (4481, 23), (4504, 29), (4533, 14), (4547, 8), (4555, 47), (4602, 52), None, None, (4654, 47), (4701, 46), None, (4747, 18), None, (4765, 15), (4780, 8), (4788, 21), (4809, 6), (4815, 29), (4844, 22)], [(4866, 8389), (13255, 8158), (21413, 8727), (30140, 8509), (38649, 8110), (46759, 8320), (55079, 8738), (63817, 8011), (71828, 8177), (80005, 7932), (87937, 8514), (96451, 7622), (104073, 8204), (112277, 9106), (121383, 8343), (129726, 9130), (138856, 9128), (147984, 7568), (155552, 8644), (164196, 7561), (171757, 8564), (180321, 8096), (188417, 8327), (196744, 8696), (205440, 8523), (213963, 8043), (222006, 8813), (230819, 9428), (240247, 7950), (248197, 8119), (256316, 8691), (265007, 8373), (273380, 8372), (281752, 8674), (290426, 8232), (298658, 8722), (307380, 8503), (315883, 9229), (325112, 8642), (333754, 8643), (342397, 8793), (351190, 7686), (358876, 8190), (367066, 8207), (375273, 7915), (383188, 8624), (391812, 7924), (399736, 9434), (409170, 8217), (417387, 7864), (425251, 8381), (433632, 7939), (441571, 8358), (449929, 8368), (458297, 8033), (466330, 8301), (474631, 8278), (482909, 8594), (491503, 8414), (499917, 7117), (507034, 7718), (514752, 8696), (523448, 8382), (531830, 8770), (540600, 9152), (549752, 7856), (557608, 8340), (565948, 8759), (574707, 9169), (583876, 8036), (591912, 7796), (599708, 7805), (607513, 7528), (615041, 8932), (623973, 7935), (631908, 8576), (640484, 7971), (648455, 9259), (657714, 8299), (666013, 8343), (674356, 8355), (682711, 7729), (690440, 8116), (698556, 8461), (707017, 8426), (715443, 8570), (724013, 8931), (732944, 8197), (741141, 7690), (748831, 8284), (757115, 9624), (766739, 8513), (775252, 7968), (783220, 8425), (791645, 8285), (799930, 8280), (808210, 8399), (816609, 7579), (824188, 8454), (832642, 7781), (840423, 8183), (848606, 7950), (856556, 8128), (864684, 7905), (872589, 8184), (880773, 8978), (889751, 8508), (898259, 8667), (906926, 8023), (914949, 7997), (922946, 8927), (931873, 8349), (940222, 7597), (947819, 7873), (955692, 8318), (964010, 8257), (972267, 8488), (980755, 8792), (989547, 8319), (997866, 8358), (1006224, 8328), (1014552, 8350), (1022902, 7928), (1030830, 8428), (1039258, 8770), (1048028, 7907), (1055935, 8123), (1064058, 9118), (1073176, 8124), (1081300, 9461), (1090761, 9132), (1099893, 8142), (1108035, 7944), (1115979, 7620), (1123599, 8048), (1131647, 8966), (1140613, 9001), (1149614, 9460), (1159074, 8633), (1167707, 8813), (1176520, 9243), (1185763, 8749), (1194512, 8265), (1202777, 8432), (1211209, 9047), (1220256, 7451), (1227707, 8370), (1236077, 8160), (1244237, 8285), (1252522, 8313), (1260835, 8389), (1269224, 8489), (1277713, 8366), (1286079, 7832), (1293911, 8013), (1301924, 8579), (1310503, 8462), (1318965, 8451), (1327416, 7953), (1335369, 7698), (1343067, 7939), (1351006, 8450), (1359456, 8444), (1367900, 7992), (1375892, 8537), (1384429, 9007), (1393436, 8809), (1402245, 7789), (1410034, 9563), (1419597, 8380), (1427977, 8154), (1436131, 8246), (1444377, 9075), (1453452, 7817), (1461269, 7979), (1469248, 8340), (1477588, 8831), (1486419, 8836), (1495255, 7907), (1503162, 7727), (1510889, 10262), (1521151, 8834), (1529985, 7976), (1537961, 8134), (1546095, 8609), (1554704, 8658), (1563362, 7674), (1571036, 9008), (1580044, 8177), (1588221, 8422), (1596643, 8357), (1605000, 7995), (1612995, 8188), (1621183, 7513), (1628696, 8333), (1637029, 7581), (1644610, 7517), (1652127, 7747), (1659874, 8068), (1667942, 8774), (1676716, 8332), (1685048, 8500), (1693548, 8800), (1702348, 7570), (1709918, 8662), (1718580, 8965), (1727545, 7835), (1735380, 8546), (1743926, 9236), (1753162, 7855), (1761017, 9187), (1770204, 8517), (1778721, 8031), (1786752, 8309), (1795061, 8554), (1803615, 8527), (1812142, 8166), (1820308, 8461), (1828769, 8058), (1836827, 8990), (1845817, 8149), (1853966, 7860), (1861826, 8877), (1870703, 8341), (1879044, 8622), (1887666, 8073), (1895739, 9096), (1904835, 8713), (1913548, 8586), (1922134, 9086), (1931220, 8921), (1940141, 8311), (1948452, 8171), (1956623, 8669), (1965292, 8128), (1973420, 9216), (1982636, 8311), (1990947, 7782), (1998729, 7827), (2006556, 8715), (2015271, 8893), (2024164, 8564), (2032728, 8625), (2041353, 8387), (2049740, 7939), (2057679, 9023), (2066702, 8461), (2075163, 8278), (2083441, 8352), (2091793, 7501), (2099294, 8234), (2107528, 8334), (2115862, 8101), (2123963, 7993), (2131956, 8224), (2140180, 8580)], [(2148760, 887), (2149647, 756), (2150403, 863), (2151266, 796), (2152062, 915), (2152977, 769), (2153746, 623), (2154369, 891), (2155260, 640), (2155900, 870), (2156770, 454), (2157224, 624), (2157848, 867), (2158715, 989), (2159704, 818), (2160522, 663), (2161185, 1267), (2162452, 755), (2163207, 718), (2163925, 829), (2164754, 1065), (2165819, 746), (2166565, 739), (2167304, 654), (2167958, 752), (2168710, 677), (2169387, 880), (2170267, 1331), (2171598, 739), (2172337, 760), (2173097, 810), (2173907, 722), (2174629, 759), (2175388, 829), (2176217, 1003), (2177220, 951), (2178171, 561), (2178732, 833), (2179565, 749), (2180314, 899), (2181213, 812), (2182025, 730), (2182755, 697), (2183452, 824), (2184276, 720), (2184996, 759), (2185755, 649), (2186404, 774), (2187178, 766), (2187944, 493), (2188437, 740), (2189177, 767), (2189944, 820), (2190764, 829), (2191593, 1315), (2192908, 686), (2193594, 862), (2194456, 699), (2195155, 570), (2195725, 648), (2196373, 791), (2197164, 863), (2198027, 952), (2198979, 849), (2199828, 673), (2200501, 751), (2201252, 921), (2202173, 656), (2202829, 582), (2203411, 1016), (2204427, 727), (2205154, 710), (2205864, 433), (2206297, 739), (2207036, 431), (2207467, 750), (2208217, 623), (2208840, 954), (2209794, 859), (2210653, 604), (2211257, 829), (2212086, 743), (2212829, 897), (2213726, 741), (2214467, 819), (2215286, 809), (2216095, 725), (2216820, 606), (2217426, 868), (2218294, 910), (2219204, 1130), (2220334, 1087), (2221421, 945), (2222366, 725), (2223091, 712), (2223803, 535), (2224338, 956), (2225294, 767), (2226061, 762), (2226823, 673), (2227496, 801), (2228297, 774), (2229071, 794), (2229865, 534), (2230399, 780), (2231179, 947), (2232126, 637), (2232763, 571), (2233334, 812), (2234146, 931), (2235077, 766), (2235843, 980), (2236823, 1081), (2237904, 669), (2238573, 687), (2239260, 729), (2239989, 759), (2240748, 863), (2241611, 662), (2242273, 736), (2243009, 1084), (2244093, 759), (2244852, 847), (2245699, 795), (2246494, 787), (2247281, 745), (2248026, 846), (2248872, 834), (2249706, 592), (2250298, 921), (2251219, 668), (2251887, 877), (2252764, 633), (2253397, 670), (2254067, 605), (2254672, 881), (2255553, 832), (2256385, 682), (2257067, 628), (2257695, 841), (2258536, 774), (2259310, 716), (2260026, 624), (2260650, 573), (2261223, 763), (2261986, 537), (2262523, 781), (2263304, 637), (2263941, 814), (2264755, 616), (2265371, 806), (2266177, 626), (2266803, 798), (2267601, 897), (2268498, 1017), (2269515, 828), (2270343, 822), (2271165, 1013), (2272178, 897), (2273075, 763), (2273838, 990), (2274828, 673), (2275501, 845), (2276346, 905), (2277251, 1041), (2278292, 1061), (2279353, 568), (2279921, 928), (2280849, 729), (2281578, 651), (2282229, 719), (2282948, 517), (2283465, 1083), (2284548, 588), (2285136, 979), (2286115, 801), (2286916, 906), (2287822, 746), (2288568, 588), (2289156, 712), (2289868, 1893), (2291761, 768), (2292529, 726), (2293255, 817), (2294072, 982), (2295054, 618), (2295672, 866), (2296538, 858), (2297396, 573), (2297969, 938), (2298907, 667), (2299574, 620), (2300194, 559), (2300753, 1154), (2301907, 755), (2302662, 728), (2303390, 603), (2303993, 673), (2304666, 954), (2305620, 828), (2306448, 836), (2307284, 750), (2308034, 833), (2308867, 663), (2309530, 665), (2310195, 607), (2310802, 696), (2311498, 1002), (2312500, 912), (2313412, 686), (2314098, 792), (2314890, 711), (2315601, 836), (2316437, 1149), (2317586, 517), (2318103, 789), (2318892, 750), (2319642, 770), (2320412, 734), (2321146, 609), (2321755, 653), (2322408, 812), (2323220, 770), (2323990, 1011), (2325001, 534), (2325535, 648), (2326183, 754), (2326937, 708), (2327645, 747), (2328392, 787), (2329179, 901), (2330080, 488), (2330568, 1024), (2331592, 620), (2332212, 685), (2332897, 708), (2333605, 865), (2334470, 626), (2335096, 847), (2335943, 876), (2336819, 821), (2337640, 511), (2338151, 836), (2338987, 503), (2339490, 853), (2340343, 557), (2340900, 730), (2341630, 871), (2342501, 650), (2343151, 886), (2344037, 2317), (2346354, 656), (2347010, 888), (2347898, 821), (2348719, 849), (2349568, 699)], [(2350267, 48), None, None, (2350315, 42), None, (2350357, 27), (2350384, 43), None, None, None, None, None, None, None, (2350427, 21), None, None, (2350448, 42), None, (2350490, 25), (2350515, 44), None, (2350559, 49), None, None, None, None, None, None, None, None, None, (2350608, 21), (2350629, 46), None, None, (2350675, 44), None, None, None, None, (2350719, 44), (2350763, 21), (2350784, 23), None, None, None, None, (2350807, 42), None, None, None, None, None, (2350849, 31), None, None, None, None, (2350880, 42), (2350922, 19), None, None, (2350941, 21), None, (2350962, 26), (2350988, 56), None, (2351044, 16), (2351060, 42), (2351102, 27), None, None, None, None, (2351129, 21), (2351150, 52), None, (2351202, 17), (2351219, 20), (2351239, 42), None, None, None, (2351281, 25), (2351306, 17), (2351323, 27), (2351350, 21), None, None, None, (2351371, 24), None, (2351395, 24), (2351419, 21), (2351440, 24), None, (2351464, 48), None, None, (2351512, 17), (2351529, 19), None, None, None, None, (2351548, 31), None, None, None, None, None, None, (2351579, 28), None, (2351607, 64), (2351671, 42), (2351713, 17), (2351730, 17), (2351747, 26), None, (2351773, 19), None, None, None, None, (2351792, 20), None, None, (2351812, 42), (2351854, 63), (2351917, 17), None, None, (2351934, 21), None, None, None, None, (2351955, 21), (2351976, 16), None, (2351992, 31), None, None, None, None, (2352023, 42), None, (2352065, 80), None, (2352145, 9), None, (2352154, 21), (2352175, 42), None, (2352217, 18), (2352235, 90), (2352325, 56), (2352381, 45), None, (2352426, 42), None, None, (2352468, 24), (2352492, 21), None, None, None, None, None, (2352513, 42), (2352555, 21), (2352576, 21), None, (2352597, 42), (2352639, 25), None, (2352664, 55), (2352719, 21), (2352740, 56), None, None, (2352796, 36), (2352832, 16), None, None, (2352848, 16), None, (2352864, 35), None, None, (2352899, 21), None, (2352920, 22), (2352942, 21), (2352963, 21), (2352984, 21), None, (2353005, 63), (2353068, 41), (2353109, 21), (2353130, 42), None, None, None, None, None, (2353172, 15), (2353187, 21), (2353208, 21), None, None, (2353229, 21), None, None, (2353250, 21), None, None, (2353271, 19), (2353290, 66), None, None, None, (2353356, 50), None, (2353406, 21), (2353427, 21), (2353448, 19), None, None, (2353467, 26), None, (2353493, 58), (2353551, 42), None, None, None, None, None, None, (2353593, 21), None, None, None, (2353614, 21), None, None, (2353635, 64), None, (2353699, 254), (2353953, 21), (2353974, 24), None, (2353998, 21), (2354019, 14)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2354033, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
